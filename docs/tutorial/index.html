<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorial" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Pathom Tutorial - IP Weather | Pathom 3</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pathom3.wsscode.com/docs/tutorial"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Pathom Tutorial - IP Weather | Pathom 3"><meta data-rh="true" name="description" content="The task of this tutorial is to implement a series of resolvers that can tell the current"><meta data-rh="true" property="og:description" content="The task of this tutorial is to implement a series of resolvers that can tell the current"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pathom3.wsscode.com/docs/tutorial"><link data-rh="true" rel="alternate" href="https://pathom3.wsscode.com/docs/tutorial" hreflang="en"><link data-rh="true" rel="alternate" href="https://pathom3.wsscode.com/docs/tutorial" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://8YW0ZACTDN-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GZFCYV0DXN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GZFCYV0DXN",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Pathom 3" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5e9cce91.css">
<link rel="preload" href="/assets/js/runtime~main.7be6ae2a.js" as="script">
<link rel="preload" href="/assets/js/main.670c6fc5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon_64x64.png" alt="Pathom 3" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/icon_64x64.png" alt="Pathom 3" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Pathom 3</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://blog.wsscode.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/media">Media</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wilkerlucio/pathom3" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/tutorial">Pathom Tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nouns">Nouns</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/resolvers">Using Pathom</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/indexes">How Pathom Works</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/integrations/graphql">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tutorials/hacker-news-scraper">Tutorials</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Pathom Tutorial</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Pathom Tutorial - IP Weather</h1></header><p>The task of this tutorial is to implement a series of resolvers that can tell the current
temperature, based on some IP address.</p><p>To implement this, I&#x27;ll use <a href="https://get.geojs.io">GeoJS</a> to find the location from some
given IP, and then use <a href="http://www.7timer.info/doc.php?lang=en#api">7timer</a> to find the temperature.</p><h2 id="app-setup">App Setup</h2><p>In this demo, I&#x27;ll be using <a href="https://clojure.org/guides/deps_and_cli">Clojure Deps</a> to manage the dependencies:</p><pre><code class="language-clojure" metastring="title=&quot;deps.edn&quot;" title="&quot;deps.edn&quot;">{:paths
 [&quot;src&quot;]

 :deps
 {cheshire/cheshire   {:mvn/version &quot;5.10.0&quot;}
  com.wsscode/pathom3 {:mvn/version &quot;2022.10.19-alpha&quot;}
  org.clojure/clojure {:mvn/version &quot;1.11.1&quot;}
  http-kit/http-kit   {:mvn/version &quot;2.5.3&quot;}}}
</code></pre><p>We are going to use <code>http-kit</code> to make our requests and <code>cheshire</code> to parse <code>JSON</code> from
the API responses.</p><h2 id="command-line-application">Command Line Application</h2><p>To run our application, we will use the <code>:exec-fn</code> feature from <code>deps.edn</code>, I&#x27;ll start
setting up the main entry point and show how to trigger it from the command line:</p><pre><code class="language-clojure">(ns com.wsscode.pathom3.demos.ip-weather)

(defn main [{:keys [ip]}]
  (println &quot;Request temperature for the IP&quot; ip))
</code></pre><p>To test this, run the following:</p><pre><code class="language-bash">clj -X com.wsscode.pathom3.demos.ip-weather/main :ip &#x27;&quot;198.29.213.3&quot;&#x27;
</code></pre><p>To make this command shorter, add an alias to <code>deps.edn</code>:</p><pre><code class="language-clojure" metastring="{10-13} title=&quot;deps.edn&quot;" title="&quot;deps.edn&quot;">{:paths
 [&quot;src&quot;]

 :deps
 {cheshire/cheshire   {:mvn/version &quot;5.10.0&quot;}
  com.wsscode/pathom3 {:mvn/version &quot;2022.10.19-alpha&quot;}
  org.clojure/clojure {:mvn/version &quot;1.11.1&quot;}
  http-kit/http-kit   {:mvn/version &quot;2.5.3&quot;}}

 ; add alias to make easier to call
 :aliases
 {:ip-weather
  {:exec-fn com.wsscode.pathom3.demos.ip-weather/main}}}
</code></pre><p>Now we can run:</p><pre><code class="language-bash">clj -X:ip-weather :ip &#x27;&quot;198.29.213.3&quot;&#x27;
</code></pre><p>Scaffolding is done. Time to start writing some application logic.</p><h3 id="start-from-the-tail">Start from the tail</h3><p>First, let&#x27;s understand the data scenario for this task. If we start assuming that we know
nothing about the services involved, we still know what we have (the IP) and what we
want (the temperature), we can start with this graph representation:</p><div class="pathom-diagram"><p>  <img src="data:image/png;base64,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" width="320" height="82"></p></div><p>By looking at the documentation on the <a href="http://www.7timer.info/doc.php?lang=en#api">7timer</a>,
I see that the temperature information is present in the
<code>http://www.7timer.info/bin/api.pl?lon=$LONGITUDE$&amp;lat=$LATITUDE$&amp;product=astro&amp;output=json</code> endpoint
. This means that to fetch the temperature, we need some <code>latitude</code> and <code>longitude</code>.</p><div class="pathom-diagram"><p>  <img src="/assets/images/table-plan-1-2f0fb83a0f43186235d4e333d30d4760.png" width="639" height="119"></p></div><p>Using the GeoJS API, we can use the endpoint <code>https://get.geojs.io/v1/ip/geo/$IP$.json</code>
to figure the latitude and longitude, given some IP:</p><p>Now we have the complete path from the <code>IP</code> to the <code>temperature</code>.</p><div class="pathom-diagram"><p>  <img src="/assets/images/table-plan-2-1a8e40192d6ec22c13a4d6db548c21e1.png" width="639" height="119"></p></div><admonition type="tip"><p>I found those API&#x27;s using the <a href="https://github.com/public-apis/public-apis">Public API&#x27;s</a>
service, I find it a great source to look for open API&#x27;s to play.</p></admonition><h3 id="resolvers">Resolvers</h3><p>In Pathom, resolvers are the main building blocks express attribute relationships.</p><p>To implement the resolvers, I&#x27;ll start with the one to fetch the latitude and longitude
from the IP:</p><pre><code class="language-clojure">(ns com.wsscode.pathom3.demos.ip-weather
  (:require
    [cheshire.core :as json]
    [com.wsscode.pathom3.connect.operation :as pco]))

(pco/defresolver ip-&gt;lat-long
  [{:keys [ip]}]
  {::pco/output [:latitude :longitude]}
  (-&gt; (slurp (str &quot;https://get.geojs.io/v1/ip/geo/&quot; ip &quot;.json&quot;))
      (json/parse-string keyword)
      (select-keys [:latitude :longitude])))

(defn main [{:keys [ip]}]
  (println &quot;Request temperature for the IP&quot; ip))
</code></pre><p>A resolver is like a function, with some constraints:</p><ol><li>The resolver input <strong>must</strong> be a map, so the input information is labeled.</li><li>A resolver <strong>must</strong> return a map, so the output information is labeled.</li><li>A resolver may also receive another map containing the environment information.</li></ol><p>To test the resolver in the REPL, call it like a function:</p><pre><code class="language-clojure">(ip-&gt;lat-long {:ip &quot;198.29.213.3&quot;})
; =&gt; {:longitude &quot;-88.0569&quot;, :latitude &quot;41.5119&quot;}
</code></pre><p>A resolver is a custom type, here is what&#x27;s inside:</p><pre><code class="language-clojure" metastring="title=&quot;ip-&gt;lat-long&quot;" title="&quot;ip-&gt;lat-long&quot;">#com.wsscode.pathom3.connect.operation.Resolver
{:config
 #:com.wsscode.pathom3.connect.operation
 {:input [:ip]
  :provides {:longitude {}
             :latitude {}}
  :output [:longitude
           :latitude]
  :op-name com.wsscode.pathom3.demos.ip-weather/ip-&gt;lat-long},

 :resolve
 #object[com.wsscode.pathom3.demos.ip_weather$ip__GT_lat_long__17350
         0x4b7b5266
         &quot;com.wsscode.pathom3.demos.ip_weather$ip__GT_lat_long__17350@4b7b5266&quot;]}
</code></pre><p>Note that in the configuration map of the resolver, we have the same <code>::pco/output</code> as
we wrote in the resolver, while the <code>::pco/input</code> was inferred from the destructuring used in
the resolver attribute vector.</p><p>You can learn more about the details at <a href="/docs/resolvers">resolvers documentation page</a>.</p><p>Now that we have the latitude and longitude, the next resolver will find a <code>temperature</code>
from them:</p><pre><code class="language-clojure" metastring="{5,14-23}">(ns com.wsscode.pathom3.demos.ip-weather
  (:require
    [cheshire.core :as json]
    [com.wsscode.pathom3.connect.operation :as pco]
    [org.httpkit.client :as http]))

(pco/defresolver ip-&gt;lat-long
  [{:keys [ip]}]
  {::pco/output [:latitude :longitude]}
  (-&gt; (slurp (str &quot;https://get.geojs.io/v1/ip/geo/&quot; ip &quot;.json&quot;))
      (json/parse-string keyword)
      (select-keys [:latitude :longitude])))

(pco/defresolver latlong-&gt;temperature
  [{:keys [latitude longitude]}]
  {:temperature
   (-&gt; @(http/request
          {:url (str &quot;http://www.7timer.info/bin/api.pl?lon=&quot; longitude
                     &quot;&amp;lat=&quot; latitude
                     &quot;&amp;product=astro&amp;output=json&quot;)})
       :body
       (json/parse-string keyword)
       :dataseries first :temp2m)})

(defn main [{:keys [ip]}]
  (println &quot;Request temperature for the IP&quot; ip))
</code></pre><admonition type="note"><p>In <code>latlong-&gt;temperature</code> resolver, we let Pathom infer the output automatically. To use this
feature, remember that the last expression <strong>must</strong> be a map. Otherwise, Pathom will
not try to infer the output.</p></admonition><p>Testing the resolver in the REPL:</p><pre><code class="language-clojure">(latlong-&gt;temperature {:longitude &quot;-88.0569&quot;, :latitude &quot;41.5119&quot;})
; =&gt; {:temperature -1}
</code></pre><p>The whole process chains nicely, starting from <code>ip</code> to <code>temperature</code>, like this:</p><pre><code class="language-clojure">(-&gt; {:ip &quot;198.29.213.3&quot;}
    ip-&gt;lat-long
    latlong-&gt;temperature)
; =&gt; {:temperature -1}
</code></pre><h3 id="graph-traversal">Graph Traversal</h3><p>In the previous example, we were able to find the temperature starting from the IP. I
like to point all the names involved in the operation when we finished it, let&#x27;s look
at it again:</p><pre><code class="language-clojure">(-&gt; {:ip &quot;198.29.213.3&quot;}
    ip-&gt;lat-long
    latlong-&gt;temperature)
</code></pre><p>We have the <code>:ip</code> attribute in a map, and then we have <code>3</code> function names,
which dictates the step. Now we will replace all the resolver names with a single
attribute: our data demand, the <code>:temperature</code>.</p><p>It&#x27;s time to leverage the attribute relations established from the resolvers.</p><p>To do this, Pathom needs some indexes that combine the attribute relations described
by a list of resolvers. This is demonstrated in the highlighted fragments of the
following snippet:</p><pre><code class="language-clojure" metastring="{4,26-29}">(ns com.wsscode.pathom3.demos.ip-weather
  (:require
    [cheshire.core :as json]
    [com.wsscode.pathom3.connect.indexes :as pci]
    [com.wsscode.pathom3.connect.operation :as pco]
    [org.httpkit.client :as http]))

(pco/defresolver ip-&gt;lat-long
  [{:keys [ip]}]
  {::pco/output [:latitude :longitude]}
  (-&gt; (slurp (str &quot;https://get.geojs.io/v1/ip/geo/&quot; ip &quot;.json&quot;))
      (json/parse-string keyword)
      (select-keys [:latitude :longitude])))

(pco/defresolver latlong-&gt;temperature
  [{:keys [latitude longitude]}]
  {:temperature
   (-&gt; @(http/request
          {:url (str &quot;http://www.7timer.info/bin/api.pl?lon=&quot; longitude
                     &quot;&amp;lat=&quot; latitude
                     &quot;&amp;product=astro&amp;output=json&quot;)})
       :body
       (json/parse-string keyword)
       :dataseries first :temp2m)})

(def env
  (pci/register [ip-&gt;lat-long
                 latlong-&gt;temperature]))

(defn main [{:keys [ip]}]
  (println &quot;Request temperature for the IP&quot; ip))
</code></pre><p>Using the indexes we generated at the name of <code>env</code>, we can do the same processing
without mentioning any resolver name, using a <a href="/docs/eql">EQL Processor</a>:</p><pre><code class="language-clojure">(p.eql/process env {:ip &quot;198.29.213.3&quot;} [:temperature])
; 5.24
</code></pre><p>Note the previous snippet doesn&#x27;t include the name of any resolver!</p><p>We can move that code to our <code>main</code> function and make our program work:</p><pre><code class="language-clojure" metastring="{6,32-35}">(ns com.wsscode.pathom3.demos.ip-weather
  (:require
    [cheshire.core :as json]
    [com.wsscode.pathom3.connect.indexes :as pci]
    [com.wsscode.pathom3.connect.operation :as pco]
    [com.wsscode.pathom3.interface.eql :as p.eql]
    [org.httpkit.client :as http]))

(pco/defresolver ip-&gt;lat-long
  [{:keys [ip]}]
  {::pco/output [:latitude :longitude]}
  (-&gt; (slurp (str &quot;https://get.geojs.io/v1/ip/geo/&quot; ip &quot;.json&quot;))
      (json/parse-string keyword)
      (select-keys [:latitude :longitude])))

(pco/defresolver latlong-&gt;temperature
  [{:keys [latitude longitude]}]
  {:temperature
   (-&gt; @(http/request
          {:url (str &quot;http://www.7timer.info/bin/api.pl?lon=&quot; longitude
                     &quot;&amp;lat=&quot; latitude
                     &quot;&amp;product=astro&amp;output=json&quot;)})
       :body
       (json/parse-string keyword)
       :dataseries first :temp2m)})

(def env
  (pci/register [ip-&gt;lat-long
                 latlong-&gt;temperature]))

(defn main [args]
  (let [temp (p.eql/process-one env args :temperature)]
    (println (str &quot;It&#x27;s currently &quot; temp &quot;C at &quot; (pr-str args)))))
</code></pre><p>Then we can run from the command line:</p><pre><code class="language-bash"># some specific IP
clj -X:ip-weather :ip &#x27;&quot;198.29.213.3&quot;&#x27;
# =&gt; It&#x27;s currently 8.33C at {:ip &quot;198.29.213.3&quot;}

# get from your IP
clj -X:ip-weather :ip &quot;\&quot;$(curl -s ifconfig.me)\&quot;&quot;
# =&gt; It&#x27;s currently ??C at {:ip &quot;YOUR_IP&quot;}
</code></pre><p>Magic? No, it&#x27;s the power of graphs!</p><p>To help understand how this works, have a look inside that <code>env</code> variable we defined (the
map on the right side):</p><div class="pathom-diagram"><p>  <img src="/assets/images/index-oir-connected-b6fd49ab417fa5fc6a1467d685e86d3c.png" width="838" height="337"></p></div><admonition type="note"><p>For now, let&#x27;s focus on the <code>index-oir</code>, which is the main index used to traverse
dependencies. Check the <a href="/docs/indexes">indexes page</a> to learn more about the other
indexes.</p></admonition><p>When we request the <code>:temperature</code>, Pathom looks in the index for a path to that attribute.
It depends on <code>:latitude</code> and <code>:longitude</code>, which we don&#x27;t have, but the index says you can
get it if you provide an <code>:ip</code>, which is in the data context. It&#x27;s the same path we described
before with the table column associations.</p><p>The previous paragraph described the <strong>planning</strong> process. The output of that process
is an execution graph that describes what it will take to fulfill the demand. Then it
starts running it, first figure <code>:latitude</code> and <code>:longitude</code> from <code>:ip</code>:</p><div class="pathom-diagram"><p>  <img src="/assets/images/table-run-1-22d6ff719af895ce86db9b8da06fc98c.png" width="639" height="119"></p></div><p>Then it can use <code>:latitude</code> and <code>:longitude</code> to get the <code>:temperature</code>:</p><div class="pathom-diagram"><p>  <img src="/assets/images/table-run-2-d820d7ffb0646f4bf99e199b58e8fdab.png" width="639" height="119"></p></div><p>Because our code only talks about context and demand, we can also use this command
line tool in a few other forms, like starting for latitude and longitude:</p><pre><code class="language-bash"># from lat long
clj -X:ip-weather :latitude &#x27;&quot;41.5119&quot;&#x27; :longitude &#x27;&quot;-88.0569&quot;&#x27;
# =&gt; It&#x27;s currently 8.33C at {:latitude &quot;41.5119&quot;, :longitude &quot;-88.0569&quot;}
</code></pre><p>As long as you use some data that has a path to the temperature, it works.</p><h2 id="whats-next">What&#x27;s next</h2><p>This concludes this tutorial. A quick review:</p><ul><li>Map the available data you have and the data you want in terms of attributes.</li><li>Write resolvers connecting the attribute names, adding more attributes as needed.</li><li>Prepare an environment with the <a href="/docs/indexes">indexes</a>.</li><li>Use an <a href="/docs/eql">EQL Processor</a> to make the information request.</li></ul><p>I designed this demo to illustrate the basic concepts of attribute modeling and Pathom.</p><p>Here are a few exercise suggestions you can do to extend this demo:</p><ul><li>Add a resolver to tell if the temperature is cold or not, based on some cold threshold</li><li>Add a resolver to use the current user public IP when nothing else is provided.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wilkerlucio/pathom3-docs/edit/master/docs/tutorial.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Getting Started</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/nouns"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Nouns</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#app-setup" class="table-of-contents__link toc-highlight">App Setup</a></li><li><a href="#command-line-application" class="table-of-contents__link toc-highlight">Command Line Application</a><ul><li><a href="#start-from-the-tail" class="table-of-contents__link toc-highlight">Start from the tail</a></li><li><a href="#resolvers" class="table-of-contents__link toc-highlight">Resolvers</a></li><li><a href="#graph-traversal" class="table-of-contents__link toc-highlight">Graph Traversal</a></li></ul></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What&#39;s next</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Presentations</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/watch?v=YaHiff2vZ_o" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Navigation with Pathom 3<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=IS3i3DTUnAI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2019 - The Maximal Graph<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=yyVKf2U8YVg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2018 - Scaling Full Stack Applications<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=r3zywlNflJI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dutch Clojure Days 2018 - Clojure Graph API’s<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://clojurians.slack.com/messages/pathom/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Wilker Lucio</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7be6ae2a.js"></script>
<script src="/assets/js/main.670c6fc5.js"></script>
</body>
</html>