<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GZFCYV0DXN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GZFCYV0DXN",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Pathom 3" href="/opensearch.xml"><title data-react-helmet="true">Cache | Pathom 3</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Cache | Pathom 3"><meta data-react-helmet="true" name="description" content="Pathom uses caching to optimize the speed of critical points in the resolution process."><meta data-react-helmet="true" property="og:description" content="Pathom uses caching to optimize the speed of critical points in the resolution process."><meta data-react-helmet="true" property="og:url" content="https://pathom3.wsscode.com/docs/cache"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://pathom3.wsscode.com/docs/cache"><link rel="stylesheet" href="/styles.4444d5c6.css">
<link rel="preload" href="/styles.488f8ab7.js" as="script">
<link rel="preload" href="/runtime~main.868e945b.js" as="script">
<link rel="preload" href="/main.25d8d50a.js" as="script">
<link rel="preload" href="/1.89ba2929.js" as="script">
<link rel="preload" href="/2.ab7b01d4.js" as="script">
<link rel="preload" href="/3.28552344.js" as="script">
<link rel="preload" href="/1be78505.fdabaee1.js" as="script">
<link rel="preload" href="/46.50848efd.js" as="script">
<link rel="preload" href="/935f2afb.b0430d98.js" as="script">
<link rel="preload" href="/17896441.da245a3d.js" as="script">
<link rel="preload" href="/083979a2.94f8f198.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon_64x64.png" alt="Pathom 3"><strong class="navbar__title">Pathom 3</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://blog.wsscode.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a class="navbar__item navbar__link" href="/media">Media</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wilkerlucio/pathom3" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon_64x64.png" alt="Pathom 3"><strong class="navbar__title">Pathom 3</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://blog.wsscode.com" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/media">Media</a></li><li class="menu__list-item"><a href="https://github.com/wilkerlucio/pathom3" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial">Pathom Tutorial</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Using Pathom</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/resolvers">Resolvers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/built-in-resolvers">Built-in Resolvers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-maps">Smart Maps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/eql">EQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/environment">Environment</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/cache">Cache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/placeholders">Placeholders</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mutations">Mutations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/error-handling">Error Handling</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugins">Plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/built-in-plugins">Built-in Plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/async">Async</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/debugging">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/foreign">Foreign Environments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dynamic-resolvers">Dynamic Resolvers</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How Pathom Works</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/indexes">Indexes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/planner">Planner</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/shape-descriptor">Shape Descriptor</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Integrations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/integrations/graphql">GraphQL</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/hacker-news-scraper">Hacker News Scraper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/serverless-pathom-gcf">Serverless Pathom with GCF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/babashka">Scripting with Babashka</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/graphql-integration">GraphQL Integration</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Cache</h1></header><div class="markdown"><p>Pathom uses caching to optimize the speed of critical points in the resolution process.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-pathom-caches"></a>What Pathom caches<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-pathom-caches" title="Direct link to heading">#</a></h2><p>There are two things that Pathom caches:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="planning-computation"></a>Planning computation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#planning-computation" title="Direct link to heading">#</a></h3><p>When there is a query, Pathom <a href="/docs/planner">computes the plan</a> and then runs it.</p><p>The plan can be simple or complex. It takes into consideration the query, indexes, and
available data. Given those are the same, it hits the cache.</p><p>This cache is set in the key <code>::pcp/plan-cache*</code> in the environment. You can set it
with the helper <code>pcp/with-plan-cache</code>.</p><p>Here is an example to setup a durable cache for the planner, which I recommend as a
good default:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(ns com.wsscode.pathom3.docs.demos.core.cache</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (:require [com.wsscode.pathom3.connect.indexes :as pci]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.connect.operation :as pco]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.connect.planner :as pcp]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.interface.eql :as p.eql]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver full-name [{::keys [first-name last-name]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::full-name (str first-name &quot; &quot; last-name)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; setup with defonce to keep during reloads</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defonce plan-cache* (atom {}))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (-&gt; (pci/register full-name)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      (pcp/with-plan-cache plan-cache*)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defn handle [tx]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (p.eql/process env tx))</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="resolver-call"></a>Resolver call<a aria-hidden="true" tabindex="-1" class="hash-link" href="#resolver-call" title="Direct link to heading">#</a></h3><p>Pathom caches the resolver result based on the resolver name, input, and parameters.</p><p>This cache is set in the key <code>::pcr/resolver-cache*</code> in the environment. You can set it
with the helper <code>pcr/with-resolver-cache</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cache-lifecycle"></a>Cache lifecycle<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cache-lifecycle" title="Direct link to heading">#</a></h2><p>By default, the environment has no cache, but the standard interfaces have their own
cache definitions.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="eql-process"></a>EQL Process<a aria-hidden="true" tabindex="-1" class="hash-link" href="#eql-process" title="Direct link to heading">#</a></h3><p>When you use the EQL interface, the runner automatically creates caches for planning
and resolvers, these caches live for that transaction process and then are discarded.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="smart-maps"></a>Smart Maps<a aria-hidden="true" tabindex="-1" class="hash-link" href="#smart-maps" title="Direct link to heading">#</a></h3><p>Smart maps use a durable form of the cache by default. The smart maps add the caches
at initialization, and they are persisted when variations of that Smart Map are created.</p><p>This means, for example, when you <code>assoc</code> on a Smart Map, the new returned Smart Map still shares the same plan and resolver caches.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-cache-protocol"></a>The cache protocol<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-cache-protocol" title="Direct link to heading">#</a></h2><p>In the namespace <code>com.wsscode.pathom3.cache</code> you can find the <code>CacheStore</code> protocol.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defprotocol CacheStore</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (-cache-lookup-or-miss [this cache-key f])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (-cache-find [this cache-key]))</span></div></div></div></div></div><p>This protocol is implemented by Pathom to <code>Atom</code> and <code>Volatile</code>, so you can use any
of those as a cache-store.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="persistent-caching"></a>Persistent caching<a aria-hidden="true" tabindex="-1" class="hash-link" href="#persistent-caching" title="Direct link to heading">#</a></h2><p>There are cases in which a persistent cache can save some processing time in the application.</p><p>For example, a Pathom server handling API requests for serving some UI. This kind of
service tends to receive the same queries over and over. Instead of re-planning on every
query, you can use a more persistent cache to re-use this computation across requests.</p><p>Here is an example of making such a configuration:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; define the query, use atom to ensure proper concurrent access</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defonce persistent-cache-plan* (atom {}))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (-&gt; (pci/register my-resolvers)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      (pcp/with-plan-cache persistent-cache-plan*)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defn handle-request [tx]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (p.eql/process env tx))</span></div></div></div></div></div><p>This way, Pathom will re-use that same cache.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>If you are sure your application won&#x27;t try to concurrently write to the cache, you can
use a <code>(volatile! {})</code> instead of the atom to gain some performance.</p></div></div><p>A concern with this approach is that this cache will grow forever, and depending on
how variadic the requests are, that can turn into an issue. To solve this, we can
use a more robust cache strategy.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-corecache"></a>Using <code>core.cache</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-corecache" title="Direct link to heading">#</a></h3><p>If you are running Pathom on the JVM, you can use the excellent <a href="https://github.com/clojure/core.cache/" target="_blank" rel="noopener noreferrer">core.cache</a>
library to implement more robust cache stores.</p><p>To demonstrate it, we will make a persistent cache using a <code>LRUCache</code> from core.cached:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(ns com.wsscode.pathom3.docs.demos.core.cache</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (:require [clojure.core.cache.wrapped :as cc]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.cache :as p.cache]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.connect.indexes :as pci]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.connect.operation :as pco]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.connect.planner :as pcp]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.interface.eql :as p.eql]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver full-name [{::keys [first-name last-name]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::full-name (str first-name &quot; &quot; last-name)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; create a new record type to use core.cache implementation</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defrecord CoreCacheStore [cache-atom]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  p.cache/CacheStore</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (-cache-lookup-or-miss [_ cache-key f]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (cc/lookup-or-miss cache-atom cache-key (fn [_] (f))))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (-cache-find [_ cache-key]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (find @cache-atom cache-key)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; helper to start a new LRU cache</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defn lru-cache [base threshold]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (-&gt; (cc/lru-cache-factory base :threshold threshold)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      (-&gt;CoreCacheStore)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; create a cache that holds only the latest 100 read plans</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defonce plan-cache* (lru-cache {} 100))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (-&gt; (pci/register full-name)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      (pcp/with-plan-cache plan-cache*)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defn handle [tx]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (p.eql/process env tx))</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="custom-cache-store-per-resolver"></a>Custom cache store per resolver<a aria-hidden="true" tabindex="-1" class="hash-link" href="#custom-cache-store-per-resolver" title="Direct link to heading">#</a></h2><p>You may want to have different caches for different resolvers, for this case you can
set the <code>::pco/cache-store</code> configuration on your resolver, and it will try to use
the cache from the keyword mentioned there.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver on-custom-cache [{:keys [foo]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/cache-store ::my-cache*}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:bar &quot;baz&quot;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (-&gt; (pci/register on-custom-cache)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      (assoc ::my-cache* (atom {}))))</span></div></div></div></div></div><p>You need to provide this custom cache, otherwise it will fallback to the default
resolver cache.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="disable-cache"></a>Disable cache<a aria-hidden="true" tabindex="-1" class="hash-link" href="#disable-cache" title="Direct link to heading">#</a></h2><p>If you want to disable the cache, here is how.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="turn-cache-off"></a>Turn cache off<a aria-hidden="true" tabindex="-1" class="hash-link" href="#turn-cache-off" title="Direct link to heading">#</a></h3><p>To completely turn off a cache, set it with a <code>nil</code> value. This way, Pathom will keep the
<code>nil</code> value, and on an attempt to use the cache, it will skip it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="per-resolver"></a>Per resolver<a aria-hidden="true" tabindex="-1" class="hash-link" href="#per-resolver" title="Direct link to heading">#</a></h3><p>You can disable the resolver cache per resolver. To do so, set <code>::pco/cache? false</code> in
the resolver configuration.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="naming-convention"></a>Naming convention<a aria-hidden="true" tabindex="-1" class="hash-link" href="#naming-convention" title="Direct link to heading">#</a></h2><p>Pathom uses the suffix <code>-cache*</code> for all cache attributes. Its recommend that users
also follow this pattern for reading consistency.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/wilkerlucio/pathom3-docs/edit/master/docs/cache.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/environment"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Environment</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/placeholders"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Placeholders Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-pathom-caches" class="table-of-contents__link">What Pathom caches</a><ul><li><a href="#planning-computation" class="table-of-contents__link">Planning computation</a></li><li><a href="#resolver-call" class="table-of-contents__link">Resolver call</a></li></ul></li><li><a href="#cache-lifecycle" class="table-of-contents__link">Cache lifecycle</a><ul><li><a href="#eql-process" class="table-of-contents__link">EQL Process</a></li><li><a href="#smart-maps" class="table-of-contents__link">Smart Maps</a></li></ul></li><li><a href="#the-cache-protocol" class="table-of-contents__link">The cache protocol</a></li><li><a href="#persistent-caching" class="table-of-contents__link">Persistent caching</a><ul><li><a href="#using-corecache" class="table-of-contents__link">Using <code>core.cache</code></a></li></ul></li><li><a href="#custom-cache-store-per-resolver" class="table-of-contents__link">Custom cache store per resolver</a></li><li><a href="#disable-cache" class="table-of-contents__link">Disable cache</a><ul><li><a href="#turn-cache-off" class="table-of-contents__link">Turn cache off</a></li><li><a href="#per-resolver" class="table-of-contents__link">Per resolver</a></li></ul></li><li><a href="#naming-convention" class="table-of-contents__link">Naming convention</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Presentations</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.youtube.com/watch?v=YaHiff2vZ_o" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Navigation with Pathom 3</a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=IS3i3DTUnAI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2019 - The Maximal Graph</a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=yyVKf2U8YVg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2018 - Scaling Full Stack Applications</a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=r3zywlNflJI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dutch Clojure Days 2018 - Clojure Graph APIâ€™s</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://clojurians.slack.com/messages/pathom/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2023 Wilker Lucio</div></div></div></footer></div>
<script src="/styles.488f8ab7.js"></script>
<script src="/runtime~main.868e945b.js"></script>
<script src="/main.25d8d50a.js"></script>
<script src="/1.89ba2929.js"></script>
<script src="/2.ab7b01d4.js"></script>
<script src="/3.28552344.js"></script>
<script src="/1be78505.fdabaee1.js"></script>
<script src="/46.50848efd.js"></script>
<script src="/935f2afb.b0430d98.js"></script>
<script src="/17896441.da245a3d.js"></script>
<script src="/083979a2.94f8f198.js"></script>
</body>
</html>