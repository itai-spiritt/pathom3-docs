<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorials/graphql-integration" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">GraphQL Integration | Pathom 3</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pathom3.wsscode.com/docs/tutorials/graphql-integration"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="GraphQL Integration | Pathom 3"><meta data-rh="true" name="description" content="This tutorial will demonstrate how you can consume GraphQL services in Pathom, making"><meta data-rh="true" property="og:description" content="This tutorial will demonstrate how you can consume GraphQL services in Pathom, making"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pathom3.wsscode.com/docs/tutorials/graphql-integration"><link data-rh="true" rel="alternate" href="https://pathom3.wsscode.com/docs/tutorials/graphql-integration" hreflang="en"><link data-rh="true" rel="alternate" href="https://pathom3.wsscode.com/docs/tutorials/graphql-integration" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://8YW0ZACTDN-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GZFCYV0DXN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GZFCYV0DXN",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Pathom 3" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5e9cce91.css">
<link rel="preload" href="/assets/js/runtime~main.7be6ae2a.js" as="script">
<link rel="preload" href="/assets/js/main.670c6fc5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon_64x64.png" alt="Pathom 3" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/icon_64x64.png" alt="Pathom 3" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Pathom 3</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://blog.wsscode.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/media">Media</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wilkerlucio/pathom3" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorial">Pathom Tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nouns">Nouns</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/resolvers">Using Pathom</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/indexes">How Pathom Works</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/integrations/graphql">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/tutorials/hacker-news-scraper">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/hacker-news-scraper">Hacker News Scraper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/serverless-pathom-gcf">Serverless Pathom with GCF</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/babashka">Scripting with Babashka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/graphql-integration">GraphQL Integration</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">GraphQL Integration</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>GraphQL Integration</h1></header><p>This tutorial will demonstrate how you can consume GraphQL services in Pathom, making
it part of the attribute system.</p><h2 id="star-wars-api">Star Wars API</h2><p>To demonstrate this integration we are going to use the <a href="https://swapi-graphql.netlify.app/">Star Wars GraphQL API</a></p><pre><code class="language-clojure">(ns com.wsscode.pathom3.docs.demos.tutorials.graphql
  (:require
    [clojure.data.json :as json]
    [com.wsscode.pathom3.graphql :as p.gql]
    [com.wsscode.pathom3.interface.eql :as p.eql]
    [org.httpkit.client :as http]))

; first a helper function to request GraphQL queries to the Star Wars API
(defn request-swapi-graphql [query]
  (-&gt; @(http/request
         {:url     &quot;https://swapi-graphql.netlify.app/.netlify/functions/index&quot;
          :method  :post
          :headers {&quot;Content-Type&quot; &quot;application/json&quot;
                    &quot;Accept&quot;       &quot;*/*&quot;}
          :body    (json/write-str {:query query})})
      :body
      json/read-str))

; lets create the environment
(def env
  (-&gt; {}
      ; this helper will pull the schema and register it in the environment
      (p.gql/connect-graphql
        {::p.gql/namespace &quot;swapi&quot;}
        request-swapi-graphql)))

(comment
  ; request all people and the title of the films they participate
  (p.eql/process
    env
    [{:swapi.Root/allPeople
      [{:swapi.PeopleConnection/people
        [:swapi.Person/name
         {:swapi.Person/filmConnection
          [{:swapi.PersonFilmsConnection/films
            [:swapi.Film/title]}]}]}]}]))
</code></pre><h2 id="federating-over-multiple-graphql-services">Federating over multiple GraphQL services</h2><p>In this part we will see how we can use Pathom to connect data leveraging multiple
GraphQL services.</p><p>In this example we are going to use the <a href="https://tmdb.apps.quintero.io/">TMDB</a> which is an open GraphQL service for
movie data.</p><p>Although the SWAPI has some data about the movies, the TMDB has more data, like overview,
images, budget...</p><p>So how can we leverage this data to augment the information we have from the SWAPI?</p><p>The first thing we need is a way to associate the SWAPI video instance, with a Movie
entry on TMDB.</p><p>For this example I&#x27;ll use a simple table mapping, that maps ids from SWAPI to TMDB.</p><pre><code class="language-clojure">(def swapi-id-&gt;tmdb-id
  {&quot;ZmlsbXM6MQ==&quot; &quot;MDoxMQ==&quot;
   &quot;ZmlsbXM6Mg==&quot; &quot;MDoxODkx&quot;
   &quot;ZmlsbXM6Mw==&quot; &quot;MDoxODky&quot;
   &quot;ZmlsbXM6NA==&quot; &quot;MDoxODkz&quot;
   &quot;ZmlsbXM6NQ==&quot; &quot;MDoxODk0&quot;
   &quot;ZmlsbXM6Ng==&quot; &quot;MDoxODk1&quot;})
</code></pre><admonition type="note"><p>I got the TMDB id&#x27;s by manually searching for the Star Wars movies there. You could
as an exercise try to make this more automatic, maybe by using the movie number or
name to search from TMDB.</p></admonition><p>Now let&#x27;s include the TMDB setup in our environment and integrate the mapping:</p><pre><code class="language-clojure">; refactor to simplify the definition of a graphql source
(defn graphql-request [url query]
  (-&gt; @(http/request
         {:url     url
          :method  :post
          :headers {&quot;Content-Type&quot; &quot;application/json&quot;
                    &quot;Accept&quot;       &quot;*/*&quot;}
          :body    (json/write-str {:query query})})
      :body
      json/read-str))

; SWAPI request
(def request-swapi
  #(graphql-request &quot;https://swapi-graphql.netlify.app/.netlify/functions/index&quot; %))

; TMDB request
(def request-tmdb
  #(graphql-request &quot;https://tmdb.apps.quintero.io/&quot; %))

(def swapi-id-&gt;tmdb-id
  {&quot;ZmlsbXM6MQ==&quot; &quot;MDoxMQ==&quot;
   &quot;ZmlsbXM6Mg==&quot; &quot;MDoxODkx&quot;
   &quot;ZmlsbXM6Mw==&quot; &quot;MDoxODky&quot;
   &quot;ZmlsbXM6NA==&quot; &quot;MDoxODkz&quot;
   &quot;ZmlsbXM6NQ==&quot; &quot;MDoxODk0&quot;
   &quot;ZmlsbXM6Ng==&quot; &quot;MDoxODk1&quot;})

(def env
  (-&gt; {}
      (pci/register
        ; apply the static mapping using a built-in resolver helper
        [(pbir/static-attribute-map-resolver :swapi.Film/id :tmdb.Node/id
           swapi-id-&gt;tmdb-id)])
      (p.gql/connect-graphql
        {::p.gql/namespace &quot;swapi&quot;}
        request-swapi)
      (p.gql/connect-graphql
        {::p.gql/namespace &quot;tmdb&quot;
         ::p.gql/ident-map {&quot;node&quot; {&quot;id&quot; [&quot;Node&quot; &quot;id&quot;]}}}
        request-tmdb)
      ; let&#x27;s integrate pathom viz so we can explore our data, note you need to add the
      ; pathom connector dependency to your project https://github.com/wilkerlucio/pathom-viz-connector
      ((requiring-resolve &#x27;com.wsscode.pathom.viz.ws-connector.pathom3/connect-env)
       &quot;gqldemo&quot;)))
</code></pre><p>Using Pathom Viz, we can use the auto-complete to explore our new possibilities:</p><p><img alt="Integrated options" src="/assets/images/autocomplete-ebfe4f0a58b57a1fea4814292a38a1ae.png" width="858" height="514"></p><admonition type="note"><p>The reason we see other types like <code>TVShow</code> is due to the fact the entry point for an
entity in TMDB is a generic type called <code>Node</code>, which means any type that implements
this interface might be a valid option here, and in this case Pathom will offer all the possible
options.</p><p>Pathom will automatically group the attributes when sending to GraphQL using the
<code>... on TYPE { attr attr2 } </code> syntax, and since in Pathom we have the full type name on
each attribute that grouping is based on looking at the last namespace part in the
attribute name.</p></admonition><p>An example query getting the title from SWAPI, while overview and budget from TMDB:</p><pre><code class="language-clojure">[{:swapi.Root/allFilms
  [{:swapi.FilmsConnection/films
    [:swapi.Film/title
     :tmdb.Movie/budget
     :tmdb.Movie/overview]}]}]
</code></pre><p><img alt="Integrated query" src="/assets/images/query-803f5c9022f5b16e50d8b9dcff9787e2.png" width="3208" height="2420"></p><admonition type="note"><p>In this scenario we see an N+1 issue. In the future this should be optimized internally
and the same process should be resolved with just one request for each GraphQL
service.</p><p>You can track this at: <a href="https://github.com/wilkerlucio/pathom3-graphql/issues/11">https://github.com/wilkerlucio/pathom3-graphql/issues/11</a></p></admonition></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wilkerlucio/pathom3-docs/edit/master/docs/tutorials/graphql-integration.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorials/babashka"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Scripting with Babashka</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#star-wars-api" class="table-of-contents__link toc-highlight">Star Wars API</a></li><li><a href="#federating-over-multiple-graphql-services" class="table-of-contents__link toc-highlight">Federating over multiple GraphQL services</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Presentations</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/watch?v=YaHiff2vZ_o" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Navigation with Pathom 3<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=IS3i3DTUnAI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2019 - The Maximal Graph<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=yyVKf2U8YVg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2018 - Scaling Full Stack Applications<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=r3zywlNflJI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dutch Clojure Days 2018 - Clojure Graph API’s<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://clojurians.slack.com/messages/pathom/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Wilker Lucio</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7be6ae2a.js"></script>
<script src="/assets/js/main.670c6fc5.js"></script>
</body>
</html>