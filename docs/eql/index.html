<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GZFCYV0DXN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GZFCYV0DXN",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Pathom 3" href="/opensearch.xml"><title data-react-helmet="true">EQL | Pathom 3</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="EQL | Pathom 3"><meta data-react-helmet="true" name="description" content="Using the EQL interface, you can request Pathom to fetch a specific shape of data."><meta data-react-helmet="true" property="og:description" content="Using the EQL interface, you can request Pathom to fetch a specific shape of data."><meta data-react-helmet="true" property="og:url" content="https://pathom3.wsscode.com/docs/eql"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://pathom3.wsscode.com/docs/eql"><link rel="stylesheet" href="/styles.4444d5c6.css">
<link rel="preload" href="/styles.40439ba3.js" as="script">
<link rel="preload" href="/runtime~main.e6e97b8a.js" as="script">
<link rel="preload" href="/main.4a27a30b.js" as="script">
<link rel="preload" href="/1.33e73229.js" as="script">
<link rel="preload" href="/2.ccb31818.js" as="script">
<link rel="preload" href="/4.a2050c74.js" as="script">
<link rel="preload" href="/1be78505.d9c494fe.js" as="script">
<link rel="preload" href="/48.f6e5660d.js" as="script">
<link rel="preload" href="/935f2afb.0ba01e53.js" as="script">
<link rel="preload" href="/17896441.3a0d6633.js" as="script">
<link rel="preload" href="/fb281ff5.8929ae40.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon_64x64.png" alt="Pathom 3"><strong class="navbar__title">Pathom 3</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://blog.wsscode.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a class="navbar__item navbar__link" href="/media">Media</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wilkerlucio/pathom3" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon_64x64.png" alt="Pathom 3"><strong class="navbar__title">Pathom 3</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://blog.wsscode.com" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/media">Media</a></li><li class="menu__list-item"><a href="https://github.com/wilkerlucio/pathom3" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial">Pathom Tutorial</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/nouns">Nouns</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Using Pathom</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/resolvers">Resolvers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/built-in-resolvers">Built-in Resolvers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-maps">Smart Maps</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/eql">EQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/environment">Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cache">Cache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/placeholders">Placeholders</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mutations">Mutations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/error-handling">Error Handling</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugins">Plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/built-in-plugins">Built-in Plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/async">Async</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/debugging">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/foreign">Foreign Environments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dynamic-resolvers">Dynamic Resolvers</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How Pathom Works</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/indexes">Indexes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/planner">Planner</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/shape-descriptor">Shape Descriptor</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Integrations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/integrations/graphql">GraphQL</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/hacker-news-scraper">Hacker News Scraper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/serverless-pathom-gcf">Serverless Pathom with GCF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/babashka">Scripting with Babashka</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/graphql-integration">GraphQL Integration</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">EQL</h1></header><div class="markdown"><p>Using the EQL interface, you can request Pathom to fetch a specific shape of data.</p><p>If you are not familiar with EQL, check <a href="https://edn-query-language.org" target="_blank" rel="noopener noreferrer">https://edn-query-language.org</a> for an overview of the syntax.</p><p>The goal of using EQL is to express some data shape (hierarchy) without the values and
let Pathom fill in the values.</p><p>Using EQL is also the most efficient way to request multiple things at once with Pathom.
With EQL, Pathom knows the full request ahead of time. Therefore, Pathom can use this information
to optimize the planning and execution.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-eql-interface"></a>Using EQL interface<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-eql-interface" title="Direct link to heading">#</a></h2><p>Keep in mind that EQL is about expressing some data hierarchy, to start simple we will
use a flat structure to demonstrate the basic usage of the EQL interface:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(ns com.wsscode.pathom.docs.eql-demos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (:require [com.wsscode.pathom3.connect.built-in.resolvers :as pbir]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.connect.indexes :as pci]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.interface.eql :as p.eql]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def indexes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [(pbir/constantly-resolver ::pi 3.1415)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (pbir/single-attr-resolver ::pi ::tau #(* % 2))]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process indexes [::pi ::tau])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {::pi 3.1415 ::tau 6.283}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="errors"></a>Errors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#errors" title="Direct link to heading">#</a></h3><p>Check the <a href="/docs/error-handling">error handling</a> page to learn about error handling on
EQL.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="nested-entities"></a>Nested entities<a aria-hidden="true" tabindex="-1" class="hash-link" href="#nested-entities" title="Direct link to heading">#</a></h3><p>Using <a href="https://edn-query-language.org/eql/1.0.0/specification.html#_joins" target="_blank" rel="noopener noreferrer">EQL joins</a> you
can make specific requirements about nested data. In this example we will simulate the
existence of many worlds where PI have different values:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def indexes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [(pbir/constantly-resolver ::pi 3.1415)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (pbir/single-attr-resolver ::pi ::tau #(* % 2))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     ; define a resolver to provide a collection of items</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (pbir/constantly-resolver ::pi-worlds</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       [{::pi 3.14}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {::pi 3.14159}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {::pi 6.8}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {::tau 20}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {::pi 10 ::tau 50}])]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process indexes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ; using a map we are able to specify nested requirements from some attribute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{::pi-worlds [::tau ::pi]}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {::pi-worlds</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;      [{::tau 6.28</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;        ::pi  3.14}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;       {::tau 6.28318</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;        ::pi  3.14159}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;       {::tau 13.6</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;        ::pi  6.8}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;       {::tau 20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;        ::pi  3.1415}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;       {::tau 50</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;        ::pi  10}]}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="providing-map-data"></a>Providing map data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#providing-map-data" title="Direct link to heading">#</a></h3><p>You can provide initial data to the EQL process using the following syntax:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process indexes {::pi 2.3} [::tau])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {::tau 4.6}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="providing-data-via-eql-idents"></a>Providing data via EQL idents<a aria-hidden="true" tabindex="-1" class="hash-link" href="#providing-data-via-eql-idents" title="Direct link to heading">#</a></h3><p>Pathom uses the EQL <code>ident</code> as a form to specify a single attribute to start requesting
data from. Here is an example using the resolvers we created before:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process indexes [{[::pi 2.3] [::tau]}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {[::pi 2.3] {::tau 4.6}}</span></div></div></div></div></div><p>In this example, given <code>PI</code> is <code>2.3</code>, <code>Tau</code> becomes <code>4.6</code>, since it&#x27;s defined as the
double of PI.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="providing-data-with-placeholders"></a>Providing data with placeholders<a aria-hidden="true" tabindex="-1" class="hash-link" href="#providing-data-with-placeholders" title="Direct link to heading">#</a></h3><p>You can use placeholders to provide in-query data for Pathom processing. To do this, lets
get back to our famous full name example, the way to provide data is to send it to
a placeholder key as <a href="https://edn-query-language.org/eql/1.0.0/specification.html#_parameters" target="_blank" rel="noopener noreferrer">EQL parameters</a>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver full-name [{::keys [first-name last-name]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::full-name (str first-name &quot; &quot; last-name)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def env (pci/register full-name))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{&#x27;(:&gt;/bret {::first-name &quot;Bret&quot; ::last-name &quot;Victor&quot;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [::full-name]}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {:&gt;/bret {:com.wsscode.pathom3.docs.placeholder/full-name &quot;Bret Victor&quot;}}</span></div></div></div></div></div><p>When moving to a placeholder context, Pathom inherits the same parent data and merges
the params data to it, to illustrate let&#x27;s make a nested example of it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{&#x27;(:&gt;/bret {::first-name &quot;Bret&quot; ::last-name &quot;Victor&quot;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [::full-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     {&#x27;(:&gt;/bard {::first-name &quot;Bard&quot;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      [::full-name]}]}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; {:&gt;/bret</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;   {:com.wsscode.pathom3.docs.placeholder/full-name &quot;Bret Victor&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;    :&gt;/bard</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;    {:com.wsscode.pathom3.docs.placeholder/full-name &quot;Bard Victor&quot;}}}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="union-queries"></a>Union queries<a aria-hidden="true" tabindex="-1" class="hash-link" href="#union-queries" title="Direct link to heading">#</a></h3><p>Union queries provide a way to achieve polymorphism in EQL, for a review on the
union syntax refer to the <a href="https://edn-query-language.org/eql/1.0.0/specification.html#_unions" target="_blank" rel="noopener noreferrer">EQL Union specification page</a>.</p><p>Consider you want to request information for some user feed. In our feed example, there
are three types of entries: posts, ads and videos. Each type requires different attributes
to render. This is how we can write some resolvers to fetch each type:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def union-env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [(pbir/static-table-resolver `posts :acme.post/id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       {1 {:acme.post/text &quot;Foo&quot;}})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (pbir/static-table-resolver `ads :acme.ad/id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       {1 {:acme.ad/backlink &quot;http://marketing.is-bad.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           :acme.ad/title    &quot;Promotion thing&quot;}})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (pbir/static-table-resolver `videos :acme.video/id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       {1 {:acme.video/title &quot;Some video&quot;}})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (pbir/constantly-resolver :acme/feed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       [{:acme.post/id 1}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {:acme.ad/id 1}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {:acme.video/id 1}])]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process union-env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{:acme/feed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {:acme.post/id  [:acme.post/text]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     :acme.ad/id    [:acme.ad/backlink :acme.ad/title]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     :acme.video/id [:acme.video/title]}}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {:acme/feed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;     [{:acme.post/text &quot;Foo&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;      {:acme.ad/backlink &quot;http://marketing.site.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;       :acme.ad/title &quot;Promotion thing&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;      {:acme.video/title &quot;Some video&quot;}]}</span></div></div></div></div></div><p>To decide which path to take, Pathom looks if the entry data contains the key mentioned
in the union entry key. When they match Pathom picks that path option.</p><p>There is a secondary option, this is more intended for implementors of dynamic resolvers.</p><p>If the meta contains the meta-data <code>::pf.eql/union-entry-key</code>, Pathom will use that
as the union entry key, example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def union-env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [(pbir/single-attr-resolver :acme.post/title :acme.post/link #(str % &quot;-link&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (pbir/single-attr-resolver :acme.ad/x :acme.ad/y inc)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (pbir/constantly-resolver :acme/feed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       [^{:com.wsscode.pathom3.format.eql/union-entry-key :acme.post/id}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {:acme.post/title &quot;TITLE&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ^{:com.wsscode.pathom3.format.eql/union-entry-key :acme.ad/id}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {:acme.ad/x 1}])]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process union-env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{:acme/feed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {:acme.post/id [:acme.post/link]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     :acme.ad/id   [:acme.ad/y]}}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {:acme/feed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;     [{:acme.post/link &quot;TITLE-link&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;      {:acme.ad/y 2}]}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="recursive-queries"></a>Recursive queries<a aria-hidden="true" tabindex="-1" class="hash-link" href="#recursive-queries" title="Direct link to heading">#</a></h3><p>Some data shapes are trees. For example, if we like to map a file system with Pathom.</p><p>I&#x27;ll start writing a few resolvers to handle paths and directory navigation:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver file-from-path [{:keys [path]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:file (io/file path)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver file-name [{:keys [^File file]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:file-name (.getName file)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver directory? [{:keys [^File file]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:directory? (.isDirectory file)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver directory-files [{:keys [^File file directory?]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/output [{:files [:file]}]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:files</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   (if directory?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (mapv #(hash-map :file %) (.listFiles file))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     ::pco/unknown-value)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def file-env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [file-from-path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     file-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     directory?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     directory-files]))</span></div></div></div></div></div><p>To demonstrate the recursive property of it, I&#x27;ll write the same nested query a few times
to show it up:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(comment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (p.eql/process file-env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {:path &quot;src&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [:file-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     {:files [:file-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              {:files [:file-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                       {:files []}]}]}]))</span></div></div></div></div></div><p>Instead of doing that, we can use <a href="https://edn-query-language.org/eql/1.0.0/specification.html#_recursive_queries" target="_blank" rel="noopener noreferrer">EQL recursive queries</a>
to handle it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(comment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (p.eql/process file-env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {:path &quot;src&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [:file-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     {:files &#x27;...}]))</span></div></div></div></div></div><p>The previous example creates an unbounded recursion. It&#x27;s going to keep going until
there is no more depth to go.</p><p>You can also limit this using bounded recursive queries:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(comment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (p.eql/process file-env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {:path &quot;src&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [:file-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     ; max of 2 depths</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     {:files 2}]))</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="wildcard"></a>Wildcard<a aria-hidden="true" tabindex="-1" class="hash-link" href="#wildcard" title="Direct link to heading">#</a></h3><p>In EQL queries, you can use the special symbol <code>*</code> to ask Pathom to give all the data
available for that entity. In other words, this removes the output filtering at that
level. Here is an example of what it means:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; define a resolver that returns multiple things</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver user-data []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:user/name       &quot;foo&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   :user/email      &quot;some-user@email.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   :user/birth-year 1988})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; standard query</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process (pci/register user-data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [:user/name])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; gets the output filtered, only the items in query show up</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">=&gt; #:user{:name &quot;foo&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; making query adding the *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process (pci/register user-data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [:user/name &#x27;*])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; now all the data that was loaded in process will show up in the result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">=&gt; #:user{:name &quot;foo&quot;, :email &quot;some-user@email.com&quot;, :birth-year 1988}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; another example, now we can see the whole deps showing up</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (pci/register</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      [user-data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       (pbir/single-attr-resolver :user/name :user/name++ #(str % &quot; - extra things&quot;))])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [:user/name++ &#x27;*])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">=&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#:user{:name++ &quot;foo - extra things&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       :name &quot;foo&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       :email &quot;some-user@email.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       :birth-year 1988}</span></div></div></div></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>The <code>*</code> only affects sibling attributes (things at same entity/level), the following
example illustrates it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register user-data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{:&gt;/ent1 [:user/name &#x27;*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             {:&gt;/nested [:user/email]}]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   {:&gt;/ent2 [:user/birth-year]}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">=&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#:&gt;{:ent1 {:user/name &quot;foo&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           :&gt;/nested #:user{:email &quot;some-user@email.com&quot;},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           :user/email &quot;some-user@email.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           :user/birth-year 1988},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    :ent2 #:user{:birth-year 1988}}</span></div></div></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="process-one"></a>Process One<a aria-hidden="true" tabindex="-1" class="hash-link" href="#process-one" title="Direct link to heading">#</a></h2><p>Sometimes you just want a single value instead of a map of values as the output. The
<code>p.eql/process-one</code> wrapper facilitates this use case:</p><p>Simplest usage:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process-one env :foo)</span></div></div></div></div></div><p>Same as process, you can send initial data:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process-one env {:data &quot;here&quot;} :foo)</span></div></div></div></div></div><p>You can also use joins and param expressions:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process-one env {:join [:sub-query]})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process-one env &#x27;(:param {:expr &quot;sion&quot;}))</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="boundary-interface"></a>Boundary Interface<a aria-hidden="true" tabindex="-1" class="hash-link" href="#boundary-interface" title="Direct link to heading">#</a></h2><p>The Pathom EQL design makes it a suitable solution to enable remote communication via
EQL syntax.</p><p>By receiving an EQL request which is pure data, a server can fetch information and
invoke mutations.</p><p>This is a powerful API, and it&#x27;s something that Pathom is designed to handle.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-the-boundary-interface"></a>Using the boundary interface<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-the-boundary-interface" title="Direct link to heading">#</a></h3><p>Using the boundary interface adds the following capabilities to the request:</p><ul><li>Add support to load the index via EQL (through <code>::pci/indexes</code> attribute)</li><li>Support provision of root entity data</li><li>Support requests in <a href="https://edn-query-language.org/eql/1.0.0/specification.html" target="_blank" rel="noopener noreferrer">AST format</a></li><li>Strict mode errors are turned into a data format instead of throwing</li></ul><p>Combined, those features allow another Pathom instance to integrate this graph.</p><p>The request to a boundary interface can be either an <code>EQL</code> request or a map. The map
has the following options available:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; initial entity data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">:pathom/entity {:foo &quot;3&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; the request in EQL format</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">:pathom/eql [:foo]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; the request in AST format</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">:pathom/ast {:type     :root</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             :children [{:type :prop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                         :key :foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                         :dispatch-key :foo}]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; activate lenient mode, check error handling page for more details</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; or set false to force strict mode</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">:pathom/lenient-mode? true</span></div></div></div></div></div><p>You should either use <code>:pathom/eql</code> or <code>:pathom/ast</code>. If both are present, Pathom will
pick the AST.</p><p>Here you can see an example of a setup and usage of the boundary interface:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(ns com.wsscode.pathom3.docs.demos.core.eql</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (:require</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [com.wsscode.pathom3.interface.eql :as p.eql]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [com.wsscode.pathom3.connect.indexes :as pci]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [com.wsscode.pathom3.connect.built-in.resolvers :as pbir]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [com.wsscode.pathom3.connect.operation :as pco])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (:import (java.util Date)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver area [{:geo/keys [width height]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:geo/area (* width height)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [(pbir/constantly-fn-resolver ::now (fn [_] (Date.)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     area]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def pathom (p.eql/boundary-interface env))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; request EQL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pathom [::now])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; send root entity data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pathom {:pathom/entity {:geo/width 10 :geo/height 8}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         :pathom/eql    [:geo/area]})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; use AST, this way Pathom doesn&#x27;t have to decode the EQL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pathom</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:pathom/ast {:type     :root</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                :children [{:type         :prop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            :key          ::now</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            :dispatch-key ::now}]}})</span></div></div></div></div></div><p>It&#x27;s recommended that you always use this at API boundaries.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="strict-errors-as-data"></a>Strict errors as data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#strict-errors-as-data" title="Direct link to heading">#</a></h3><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Strict errors as data is feature from Pathom 3 <code>2022.02.21-alpha+</code> versions.</p></div></div><p>When using the boundary interface, errors that would normally throw when using the EQL
interface directly will be turned into a map format. This is more suitable to a boundary
interface because then we can send this error reporting over the wire with ease.</p><p>The error format is opinionated, and it looks like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{:com.wsscode.pathom3.error/error-message &quot;Pathom can&#x27;t find a path for the following elements in the query: [:wrong] at path []&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> :com.wsscode.pathom3.error/error-data {:com.wsscode.pathom3.connect.planner/graph {:com.wsscode.pathom3.connect.planner/nodes {},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                    :com.wsscode.pathom3.connect.planner/index-ast {:wrong {:type :prop,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                                                                            :dispatch-key :wrong,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                                                                            :key :wrong}},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                    :com.wsscode.pathom3.connect.planner/source-ast {:type :root,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                                                                     :children [{:type :prop,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                                                                                 :dispatch-key :wrong,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                                                                                 :key :wrong}]},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                    :com.wsscode.pathom3.connect.planner/available-data {},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                    :com.wsscode.pathom3.connect.planner/unreachable-paths {:wrong {}}},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                        :com.wsscode.pathom3.connect.planner/unreachable-paths {:wrong {}},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                        :com.wsscode.pathom3.path/path [],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                        :com.wsscode.pathom3.error/phase :com.wsscode.pathom3.connect.planner/plan,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                        :com.wsscode.pathom3.error/cause :com.wsscode.pathom3.error/attribute-unreachable},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> :com.wsscode.pathom3.error/error-stack &quot;clojure.lang.ExceptionInfo: Pathom can&#x27;t find a path for the following elements in the query: [:wrong] at path [] {:com.wsscode.pathom3.connect.planner/graph {:com.wsscode.pathom3.connect.planner/nodes {}, :com.wsscode.pathom3.connect.planner/index-ast {:wrong {:type :prop, :dispatch-key :wrong, :key :wrong}}, :com.wsscode.pathom3.connect.planner/source-ast {:type :root, :children [{:type :prop, :dispatch-key :wrong, :key :wrong}]}, :com.wsscode.pathom3.connect.planner/available-data {}, :com.wsscode.pathom3.connect.planner/unreachable-paths {:wrong {}}}, :com.wsscode.pathom3.connect.planner/unreachable-paths {:wrong {}}, :com.wsscode.pathom3.path/path [], :com.wsscode.pathom3.error/phase :com.wsscode.pathom3.connect.planner/plan, :com.wsscode.pathom3.error/cause :com.wsscode.pathom3.error/attribute-unreachable}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                         \tat com.wsscode.pathom3.connect.planner$verify_plan_BANG__STAR_.invokeStatic(planner.cljc:1510)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                         \tat com.wsscode.pathom3.connect.planner$verify_plan_BANG__STAR_.invoke(planner.cljc:1500)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                         \tat com.wsscode.pathom3.connect.planner$verify_plan_BANG_.invokeStatic(planner.cljc:1529)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                         \tat com.wsscode.pathom3.connect.planner$verify_plan_BANG_.invoke(planner.cljc:1522)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                         ...&quot;}</span></div></div></div></div></div><p>Then, clients on the receiving end can use this to report the error back.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="extending-environment"></a>Extending environment<a aria-hidden="true" tabindex="-1" class="hash-link" href="#extending-environment" title="Direct link to heading">#</a></h3><p>The boundary API design is to make it flexible, and although is more efficient
to initialize as much as possible before in the env, it still allows extension of
it.</p><p>To extend the env you can send another argument to the boundary interface.</p><p>For example, let&#x27;s say we have a resolver to get data from the current user. The current
user is something we like to set at the start of the process, but we don&#x27;t want to allow
users to override it (for security reasons).</p><p>In this case we can set the user id on env when we call the boundary interface:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def users-db</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {1 {:user/login &quot;bunny&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   2 {:user/login &quot;fox&quot;}})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver current-user [{:keys [app/current-user-id]} _]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/output [:user/login]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (get users-db current-user-id))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def env (pci/register current-user))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def pathom (p.eql/boundary-interface env))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pathom {:app/current-user-id 1} [:user/login])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {:user/login &quot;bunny&quot;}</span></div></div></div></div></div><p>In this example we sent env as a map, the boundary interface gets this map and merges
into the previous env and runs.</p><p>The env extension can also be a function, this allows more complex operations like
registering new resolvers, for example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pathom</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (fn [env]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (-&gt; env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        (assoc :app/current-user-id 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        (pci/register (pbir/single-attr-resolver :user/login :user/greet #(str &quot;Hello &quot; %)))))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [:user/greet])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {:user/greet &quot;Hello fox&quot;}</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/wilkerlucio/pathom3-docs/edit/master/docs/eql.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/smart-maps"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Smart Maps</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/environment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Environment Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#using-eql-interface" class="table-of-contents__link">Using EQL interface</a><ul><li><a href="#errors" class="table-of-contents__link">Errors</a></li><li><a href="#nested-entities" class="table-of-contents__link">Nested entities</a></li><li><a href="#providing-map-data" class="table-of-contents__link">Providing map data</a></li><li><a href="#providing-data-via-eql-idents" class="table-of-contents__link">Providing data via EQL idents</a></li><li><a href="#providing-data-with-placeholders" class="table-of-contents__link">Providing data with placeholders</a></li><li><a href="#union-queries" class="table-of-contents__link">Union queries</a></li><li><a href="#recursive-queries" class="table-of-contents__link">Recursive queries</a></li><li><a href="#wildcard" class="table-of-contents__link">Wildcard</a></li></ul></li><li><a href="#process-one" class="table-of-contents__link">Process One</a></li><li><a href="#boundary-interface" class="table-of-contents__link">Boundary Interface</a><ul><li><a href="#using-the-boundary-interface" class="table-of-contents__link">Using the boundary interface</a></li><li><a href="#strict-errors-as-data" class="table-of-contents__link">Strict errors as data</a></li><li><a href="#extending-environment" class="table-of-contents__link">Extending environment</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Presentations</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.youtube.com/watch?v=YaHiff2vZ_o" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Navigation with Pathom 3</a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=IS3i3DTUnAI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2019 - The Maximal Graph</a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=yyVKf2U8YVg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2018 - Scaling Full Stack Applications</a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=r3zywlNflJI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dutch Clojure Days 2018 - Clojure Graph APIâ€™s</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://clojurians.slack.com/messages/pathom/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2023 Wilker Lucio</div></div></div></footer></div>
<script src="/styles.40439ba3.js"></script>
<script src="/runtime~main.e6e97b8a.js"></script>
<script src="/main.4a27a30b.js"></script>
<script src="/1.33e73229.js"></script>
<script src="/2.ccb31818.js"></script>
<script src="/4.a2050c74.js"></script>
<script src="/1be78505.d9c494fe.js"></script>
<script src="/48.f6e5660d.js"></script>
<script src="/935f2afb.0ba01e53.js"></script>
<script src="/17896441.3a0d6633.js"></script>
<script src="/fb281ff5.8929ae40.js"></script>
</body>
</html>