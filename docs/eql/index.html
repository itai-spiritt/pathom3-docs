<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-eql">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GZFCYV0DXN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GZFCYV0DXN",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Pathom 3" href="/opensearch.xml"><title data-rh="true">EQL | Pathom 3</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pathom3.wsscode.com/docs/eql"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="EQL | Pathom 3"><meta data-rh="true" name="description" content="Using the EQL interface, you can request Pathom to fetch a specific shape of data."><meta data-rh="true" property="og:description" content="Using the EQL interface, you can request Pathom to fetch a specific shape of data."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pathom3.wsscode.com/docs/eql"><link data-rh="true" rel="alternate" href="https://pathom3.wsscode.com/docs/eql" hreflang="en"><link data-rh="true" rel="alternate" href="https://pathom3.wsscode.com/docs/eql" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://8YW0ZACTDN-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.50c9537c.css">
<link rel="preload" href="/assets/js/runtime~main.feaca457.js" as="script">
<link rel="preload" href="/assets/js/main.5057d4a7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon_64x64.png" alt="Pathom 3" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/icon_64x64.png" alt="Pathom 3" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Pathom 3</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://blog.wsscode.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/media">Media</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wilkerlucio/pathom3" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorial">Pathom Tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nouns">Nouns</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/resolvers">Using Pathom</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/resolvers">Resolvers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/built-in-resolvers">Built-in Resolvers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-maps">Smart Maps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/eql">EQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/environment">Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cache">Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/placeholders">Placeholders</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mutations">Mutations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/error-handling">Error Handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugins">Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/built-in-plugins">Built-in Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/async">Async</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/debugging">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/foreign">Foreign Environments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dynamic-resolvers">Dynamic Resolvers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/indexes">How Pathom Works</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/integrations/graphql">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tutorials/hacker-news-scraper">Tutorials</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Using Pathom</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">EQL</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>EQL</h1></header><p>Using the EQL interface, you can request Pathom to fetch a specific shape of data.</p><p>If you are not familiar with EQL, check <a href="https://edn-query-language.org">https://edn-query-language.org</a> for an overview of the syntax.</p><p>The goal of using EQL is to express some data shape (hierarchy) without the values and
let Pathom fill in the values.</p><p>Using EQL is also the most efficient way to request multiple things at once with Pathom.
With EQL, Pathom knows the full request ahead of time. Therefore, Pathom can use this information
to optimize the planning and execution.</p><h2 id="using-eql-interface">Using EQL interface</h2><p>Keep in mind that EQL is about expressing some data hierarchy, to start simple we will
use a flat structure to demonstrate the basic usage of the EQL interface:</p><pre><code class="language-clojure">(ns com.wsscode.pathom.docs.eql-demos
  (:require [com.wsscode.pathom3.connect.built-in.resolvers :as pbir]
            [com.wsscode.pathom3.connect.indexes :as pci]
            [com.wsscode.pathom3.interface.eql :as p.eql]))

(def indexes
  (pci/register
    [(pbir/constantly-resolver ::pi 3.1415)
     (pbir/single-attr-resolver ::pi ::tau #(* % 2))]))

(p.eql/process indexes [::pi ::tau])
; =&gt; {::pi 3.1415 ::tau 6.283}
</code></pre><h3 id="errors">Errors</h3><p>Check the <a href="/docs/error-handling">error handling</a> page to learn about error handling on
EQL.</p><h3 id="nested-entities">Nested entities</h3><p>Using <a href="https://edn-query-language.org/eql/1.0.0/specification.html#_joins">EQL joins</a> you
can make specific requirements about nested data. In this example we will simulate the
existence of many worlds where PI have different values:</p><pre><code class="language-clojure">(def indexes
  (pci/register
    [(pbir/constantly-resolver ::pi 3.1415)
     (pbir/single-attr-resolver ::pi ::tau #(* % 2))
     ; define a resolver to provide a collection of items
     (pbir/constantly-resolver ::pi-worlds
       [{::pi 3.14}
        {::pi 3.14159}
        {::pi 6.8}
        {::tau 20}
        {::pi 10 ::tau 50}])]))

(p.eql/process indexes
  ; using a map we are able to specify nested requirements from some attribute
  [{::pi-worlds [::tau ::pi]}])
; =&gt; {::pi-worlds
;      [{::tau 6.28
;        ::pi  3.14}
;       {::tau 6.28318
;        ::pi  3.14159}
;       {::tau 13.6
;        ::pi  6.8}
;       {::tau 20
;        ::pi  3.1415}
;       {::tau 50
;        ::pi  10}]}
</code></pre><h3 id="providing-map-data">Providing map data</h3><p>You can provide initial data to the EQL process using the following syntax:</p><pre><code class="language-clojure">(p.eql/process indexes {::pi 2.3} [::tau])
; =&gt; {::tau 4.6}
</code></pre><h3 id="providing-data-via-eql-idents">Providing data via EQL idents</h3><p>Pathom uses the EQL <code>ident</code> as a form to specify a single attribute to start requesting
data from. Here is an example using the resolvers we created before:</p><pre><code class="language-clojure">(p.eql/process indexes [{[::pi 2.3] [::tau]}])
; =&gt; {[::pi 2.3] {::tau 4.6}}
</code></pre><p>In this example, given <code>PI</code> is <code>2.3</code>, <code>Tau</code> becomes <code>4.6</code>, since it&#x27;s defined as the
double of PI.</p><h3 id="providing-data-with-placeholders">Providing data with placeholders</h3><p>You can use placeholders to provide in-query data for Pathom processing. To do this, lets
get back to our famous full name example, the way to provide data is to send it to
a placeholder key as <a href="https://edn-query-language.org/eql/1.0.0/specification.html#_parameters">EQL parameters</a>:</p><pre><code class="language-clojure">(pco/defresolver full-name [{::keys [first-name last-name]}]
  {::full-name (str first-name &quot; &quot; last-name)})

(def env (pci/register full-name))

(p.eql/process env
  [{&#x27;(:&gt;/bret {::first-name &quot;Bret&quot; ::last-name &quot;Victor&quot;})
    [::full-name]}])
; =&gt; {:&gt;/bret {:com.wsscode.pathom3.docs.placeholder/full-name &quot;Bret Victor&quot;}}
</code></pre><p>When moving to a placeholder context, Pathom inherits the same parent data and merges
the params data to it, to illustrate let&#x27;s make a nested example of it:</p><pre><code class="language-clojure">(p.eql/process env
  [{&#x27;(:&gt;/bret {::first-name &quot;Bret&quot; ::last-name &quot;Victor&quot;})
    [::full-name
     {&#x27;(:&gt;/bard {::first-name &quot;Bard&quot;})
      [::full-name]}]}])
; {:&gt;/bret
;   {:com.wsscode.pathom3.docs.placeholder/full-name &quot;Bret Victor&quot;,
;    :&gt;/bard
;    {:com.wsscode.pathom3.docs.placeholder/full-name &quot;Bard Victor&quot;}}}
</code></pre><h3 id="union-queries">Union queries</h3><p>Union queries provide a way to achieve polymorphism in EQL, for a review on the
union syntax refer to the <a href="https://edn-query-language.org/eql/1.0.0/specification.html#_unions">EQL Union specification page</a>.</p><p>Consider you want to request information for some user feed. In our feed example, there
are three types of entries: posts, ads and videos. Each type requires different attributes
to render. This is how we can write some resolvers to fetch each type:</p><pre><code class="language-clojure">(def union-env
  (pci/register
    [(pbir/static-table-resolver `posts :acme.post/id
       {1 {:acme.post/text &quot;Foo&quot;}})
     (pbir/static-table-resolver `ads :acme.ad/id
       {1 {:acme.ad/backlink &quot;http://marketing.is-bad.com&quot;
           :acme.ad/title    &quot;Promotion thing&quot;}})
     (pbir/static-table-resolver `videos :acme.video/id
       {1 {:acme.video/title &quot;Some video&quot;}})
     (pbir/constantly-resolver :acme/feed
       [{:acme.post/id 1}
        {:acme.ad/id 1}
        {:acme.video/id 1}])]))

(p.eql/process union-env
  [{:acme/feed
    {:acme.post/id  [:acme.post/text]
     :acme.ad/id    [:acme.ad/backlink :acme.ad/title]
     :acme.video/id [:acme.video/title]}}])
; =&gt; {:acme/feed
;     [{:acme.post/text &quot;Foo&quot;}
;      {:acme.ad/backlink &quot;http://marketing.site.com&quot;,
;       :acme.ad/title &quot;Promotion thing&quot;}
;      {:acme.video/title &quot;Some video&quot;}]}
</code></pre><p>To decide which path to take, Pathom looks if the entry data contains the key mentioned
in the union entry key. When they match Pathom picks that path option.</p><p>There is a secondary option, this is more intended for implementors of dynamic resolvers.</p><p>If the meta contains the meta-data <code>::pf.eql/union-entry-key</code>, Pathom will use that
as the union entry key, example:</p><pre><code class="language-clojure">(def union-env
  (pci/register
    [(pbir/single-attr-resolver :acme.post/title :acme.post/link #(str % &quot;-link&quot;))
     (pbir/single-attr-resolver :acme.ad/x :acme.ad/y inc)
     (pbir/constantly-resolver :acme/feed
       [^{:com.wsscode.pathom3.format.eql/union-entry-key :acme.post/id}
        {:acme.post/title &quot;TITLE&quot;}
        ^{:com.wsscode.pathom3.format.eql/union-entry-key :acme.ad/id}
        {:acme.ad/x 1}])]))

(p.eql/process union-env
  [{:acme/feed
    {:acme.post/id [:acme.post/link]
     :acme.ad/id   [:acme.ad/y]}}])
; =&gt; {:acme/feed
;     [{:acme.post/link &quot;TITLE-link&quot;}
;      {:acme.ad/y 2}]}
</code></pre><h3 id="recursive-queries">Recursive queries</h3><p>Some data shapes are trees. For example, if we like to map a file system with Pathom.</p><p>I&#x27;ll start writing a few resolvers to handle paths and directory navigation:</p><pre><code class="language-clojure">(pco/defresolver file-from-path [{:keys [path]}]
  {:file (io/file path)})

(pco/defresolver file-name [{:keys [^File file]}]
  {:file-name (.getName file)})

(pco/defresolver directory? [{:keys [^File file]}]
  {:directory? (.isDirectory file)})

(pco/defresolver directory-files [{:keys [^File file directory?]}]
  {::pco/output [{:files [:file]}]}
  {:files
   (if directory?
     (mapv #(hash-map :file %) (.listFiles file))
     ::pco/unknown-value)})

(def file-env
  (pci/register
    [file-from-path
     file-name
     directory?
     directory-files]))
</code></pre><p>To demonstrate the recursive property of it, I&#x27;ll write the same nested query a few times
to show it up:</p><pre><code class="language-clojure">(comment
  (p.eql/process file-env
    {:path &quot;src&quot;}
    [:file-name
     {:files [:file-name
              {:files [:file-name
                       {:files []}]}]}]))
</code></pre><p>Instead of doing that, we can use <a href="https://edn-query-language.org/eql/1.0.0/specification.html#_recursive_queries">EQL recursive queries</a>
to handle it:</p><pre><code class="language-clojure">(comment
  (p.eql/process file-env
    {:path &quot;src&quot;}
    [:file-name
     {:files &#x27;...}]))
</code></pre><p>The previous example creates an unbounded recursion. It&#x27;s going to keep going until
there is no more depth to go.</p><p>You can also limit this using bounded recursive queries:</p><pre><code class="language-clojure">(comment
  (p.eql/process file-env
    {:path &quot;src&quot;}
    [:file-name
     ; max of 2 depths
     {:files 2}]))
</code></pre><h3 id="wildcard">Wildcard</h3><p>In EQL queries, you can use the special symbol <code>*</code> to ask Pathom to give all the data
available for that entity. In other words, this removes the output filtering at that
level. Here is an example of what it means:</p><pre><code class="language-clojure">; define a resolver that returns multiple things
(pco/defresolver user-data []
  {:user/name       &quot;foo&quot;
   :user/email      &quot;some-user@email.com&quot;
   :user/birth-year 1988})

; standard query
(p.eql/process (pci/register user-data)
    [:user/name])
; gets the output filtered, only the items in query show up
=&gt; #:user{:name &quot;foo&quot;}

; making query adding the *
(p.eql/process (pci/register user-data)
    [:user/name &#x27;*])
; now all the data that was loaded in process will show up in the result
=&gt; #:user{:name &quot;foo&quot;, :email &quot;some-user@email.com&quot;, :birth-year 1988}

; another example, now we can see the whole deps showing up
(p.eql/process
    (pci/register
      [user-data
       (pbir/single-attr-resolver :user/name :user/name++ #(str % &quot; - extra things&quot;))])
    [:user/name++ &#x27;*])
=&gt;
#:user{:name++ &quot;foo - extra things&quot;,
       :name &quot;foo&quot;,
       :email &quot;some-user@email.com&quot;,
       :birth-year 1988}
</code></pre><admonition type="important"><p>The <code>*</code> only affects sibling attributes (things at same entity/level), the following
example illustrates it:</p><pre><code class="language-clojure">(p.eql/process
  (pci/register user-data)
  [{:&gt;/ent1 [:user/name &#x27;*
             {:&gt;/nested [:user/email]}]}
   {:&gt;/ent2 [:user/birth-year]}])
=&gt;
#:&gt;{:ent1 {:user/name &quot;foo&quot;,
           :&gt;/nested #:user{:email &quot;some-user@email.com&quot;},
           :user/email &quot;some-user@email.com&quot;,
           :user/birth-year 1988},
    :ent2 #:user{:birth-year 1988}}
</code></pre></admonition><h2 id="process-one">Process One</h2><p>Sometimes you just want a single value instead of a map of values as the output. The
<code>p.eql/process-one</code> wrapper facilitates this use case:</p><p>Simplest usage:</p><pre><code class="language-clojure">(p.eql/process-one env :foo)
</code></pre><p>Same as process, you can send initial data:</p><pre><code class="language-clojure">(p.eql/process-one env {:data &quot;here&quot;} :foo)
</code></pre><p>You can also use joins and param expressions:</p><pre><code class="language-clojure">(p.eql/process-one env {:join [:sub-query]})
(p.eql/process-one env &#x27;(:param {:expr &quot;sion&quot;}))
</code></pre><h2 id="boundary-interface">Boundary Interface</h2><p>The Pathom EQL design makes it a suitable solution to enable remote communication via
EQL syntax.</p><p>By receiving an EQL request which is pure data, a server can fetch information and
invoke mutations.</p><p>This is a powerful API, and it&#x27;s something that Pathom is designed to handle.</p><h3 id="using-the-boundary-interface">Using the boundary interface</h3><p>Using the boundary interface adds the following capabilities to the request:</p><ul><li>Add support to load the index via EQL (through <code>::pci/indexes</code> attribute)</li><li>Support provision of root entity data</li><li>Support requests in <a href="https://edn-query-language.org/eql/1.0.0/specification.html">AST format</a></li><li>Strict mode errors are turned into a data format instead of throwing</li></ul><p>Combined, those features allow another Pathom instance to integrate this graph.</p><p>The request to a boundary interface can be either an <code>EQL</code> request or a map. The map
has the following options available:</p><pre><code class="language-clojure">; initial entity data
:pathom/entity {:foo &quot;3&quot;}

; the request in EQL format
:pathom/eql [:foo]

; the request in AST format
:pathom/ast {:type     :root
             :children [{:type :prop
                         :key :foo
                         :dispatch-key :foo}]}

; activate lenient mode, check error handling page for more details
; or set false to force strict mode
:pathom/lenient-mode? true
</code></pre><p>You should either use <code>:pathom/eql</code> or <code>:pathom/ast</code>. If both are present, Pathom will
pick the AST.</p><p>Here you can see an example of a setup and usage of the boundary interface:</p><pre><code class="language-clojure">(ns com.wsscode.pathom3.docs.demos.core.eql
  (:require
    [com.wsscode.pathom3.interface.eql :as p.eql]
    [com.wsscode.pathom3.connect.indexes :as pci]
    [com.wsscode.pathom3.connect.built-in.resolvers :as pbir]
    [com.wsscode.pathom3.connect.operation :as pco])
  (:import (java.util Date)))

(pco/defresolver area [{:geo/keys [width height]}]
  {:geo/area (* width height)})

(def env
  (pci/register
    [(pbir/constantly-fn-resolver ::now (fn [_] (Date.)))
     area]))

(def pathom (p.eql/boundary-interface env))

; request EQL
(pathom [::now])

; send root entity data
(pathom {:pathom/entity {:geo/width 10 :geo/height 8}
         :pathom/eql    [:geo/area]})

; use AST, this way Pathom doesn&#x27;t have to decode the EQL
(pathom
  {:pathom/ast {:type     :root
                :children [{:type         :prop
                            :key          ::now
                            :dispatch-key ::now}]}})
</code></pre><p>It&#x27;s recommended that you always use this at API boundaries.</p><h3 id="strict-errors-as-data">Strict errors as data</h3><admonition type="info"><p>Strict errors as data is feature from Pathom 3 <code>2022.02.21-alpha+</code> versions.</p></admonition><p>When using the boundary interface, errors that would normally throw when using the EQL
interface directly will be turned into a map format. This is more suitable to a boundary
interface because then we can send this error reporting over the wire with ease.</p><p>The error format is opinionated, and it looks like this:</p><pre><code class="language-clojure">{:com.wsscode.pathom3.error/error-message &quot;Pathom can&#x27;t find a path for the following elements in the query: [:wrong] at path []&quot;,
 :com.wsscode.pathom3.error/error-data {:com.wsscode.pathom3.connect.planner/graph {:com.wsscode.pathom3.connect.planner/nodes {},
                                                                                    :com.wsscode.pathom3.connect.planner/index-ast {:wrong {:type :prop,
                                                                                                                                            :dispatch-key :wrong,
                                                                                                                                            :key :wrong}},
                                                                                    :com.wsscode.pathom3.connect.planner/source-ast {:type :root,
                                                                                                                                     :children [{:type :prop,
                                                                                                                                                 :dispatch-key :wrong,
                                                                                                                                                 :key :wrong}]},
                                                                                    :com.wsscode.pathom3.connect.planner/available-data {},
                                                                                    :com.wsscode.pathom3.connect.planner/unreachable-paths {:wrong {}}},
                                        :com.wsscode.pathom3.connect.planner/unreachable-paths {:wrong {}},
                                        :com.wsscode.pathom3.path/path [],
                                        :com.wsscode.pathom3.error/phase :com.wsscode.pathom3.connect.planner/plan,
                                        :com.wsscode.pathom3.error/cause :com.wsscode.pathom3.error/attribute-unreachable},
 :com.wsscode.pathom3.error/error-stack &quot;clojure.lang.ExceptionInfo: Pathom can&#x27;t find a path for the following elements in the query: [:wrong] at path [] {:com.wsscode.pathom3.connect.planner/graph {:com.wsscode.pathom3.connect.planner/nodes {}, :com.wsscode.pathom3.connect.planner/index-ast {:wrong {:type :prop, :dispatch-key :wrong, :key :wrong}}, :com.wsscode.pathom3.connect.planner/source-ast {:type :root, :children [{:type :prop, :dispatch-key :wrong, :key :wrong}]}, :com.wsscode.pathom3.connect.planner/available-data {}, :com.wsscode.pathom3.connect.planner/unreachable-paths {:wrong {}}}, :com.wsscode.pathom3.connect.planner/unreachable-paths {:wrong {}}, :com.wsscode.pathom3.path/path [], :com.wsscode.pathom3.error/phase :com.wsscode.pathom3.connect.planner/plan, :com.wsscode.pathom3.error/cause :com.wsscode.pathom3.error/attribute-unreachable}
                                         \tat com.wsscode.pathom3.connect.planner$verify_plan_BANG__STAR_.invokeStatic(planner.cljc:1510)
                                         \tat com.wsscode.pathom3.connect.planner$verify_plan_BANG__STAR_.invoke(planner.cljc:1500)
                                         \tat com.wsscode.pathom3.connect.planner$verify_plan_BANG_.invokeStatic(planner.cljc:1529)
                                         \tat com.wsscode.pathom3.connect.planner$verify_plan_BANG_.invoke(planner.cljc:1522)
                                         ...&quot;}
</code></pre><p>Then, clients on the receiving end can use this to report the error back.</p><h3 id="extending-environment">Extending environment</h3><p>The boundary API design is to make it flexible, and although is more efficient
to initialize as much as possible before in the env, it still allows extension of
it.</p><p>To extend the env you can send another argument to the boundary interface.</p><p>For example, let&#x27;s say we have a resolver to get data from the current user. The current
user is something we like to set at the start of the process, but we don&#x27;t want to allow
users to override it (for security reasons).</p><p>In this case we can set the user id on env when we call the boundary interface:</p><pre><code class="language-clojure">(def users-db
  {1 {:user/login &quot;bunny&quot;}
   2 {:user/login &quot;fox&quot;}})

(pco/defresolver current-user [{:keys [app/current-user-id]} _]
  {::pco/output [:user/login]}
  (get users-db current-user-id))

(def env (pci/register current-user))

(def pathom (p.eql/boundary-interface env))

(pathom {:app/current-user-id 1} [:user/login])
; =&gt; {:user/login &quot;bunny&quot;}
</code></pre><p>In this example we sent env as a map, the boundary interface gets this map and merges
into the previous env and runs.</p><p>The env extension can also be a function, this allows more complex operations like
registering new resolvers, for example:</p><pre><code class="language-clojure">(pathom
  (fn [env]
    (-&gt; env
        (assoc :app/current-user-id 2)
        (pci/register (pbir/single-attr-resolver :user/login :user/greet #(str &quot;Hello &quot; %)))))
  [:user/greet])
; =&gt; {:user/greet &quot;Hello fox&quot;}
</code></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wilkerlucio/pathom3-docs/edit/master/docs/eql.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/smart-maps"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Smart Maps</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/environment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Environment</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#using-eql-interface" class="table-of-contents__link toc-highlight">Using EQL interface</a><ul><li><a href="#errors" class="table-of-contents__link toc-highlight">Errors</a></li><li><a href="#nested-entities" class="table-of-contents__link toc-highlight">Nested entities</a></li><li><a href="#providing-map-data" class="table-of-contents__link toc-highlight">Providing map data</a></li><li><a href="#providing-data-via-eql-idents" class="table-of-contents__link toc-highlight">Providing data via EQL idents</a></li><li><a href="#providing-data-with-placeholders" class="table-of-contents__link toc-highlight">Providing data with placeholders</a></li><li><a href="#union-queries" class="table-of-contents__link toc-highlight">Union queries</a></li><li><a href="#recursive-queries" class="table-of-contents__link toc-highlight">Recursive queries</a></li><li><a href="#wildcard" class="table-of-contents__link toc-highlight">Wildcard</a></li></ul></li><li><a href="#process-one" class="table-of-contents__link toc-highlight">Process One</a></li><li><a href="#boundary-interface" class="table-of-contents__link toc-highlight">Boundary Interface</a><ul><li><a href="#using-the-boundary-interface" class="table-of-contents__link toc-highlight">Using the boundary interface</a></li><li><a href="#strict-errors-as-data" class="table-of-contents__link toc-highlight">Strict errors as data</a></li><li><a href="#extending-environment" class="table-of-contents__link toc-highlight">Extending environment</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Presentations</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/watch?v=YaHiff2vZ_o" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Navigation with Pathom 3<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=IS3i3DTUnAI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2019 - The Maximal Graph<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=yyVKf2U8YVg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2018 - Scaling Full Stack Applications<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=r3zywlNflJI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dutch Clojure Days 2018 - Clojure Graph API’s<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://clojurians.slack.com/messages/pathom/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Wilker Lucio</div></div></div></footer></div>
<script src="/assets/js/runtime~main.feaca457.js"></script>
<script src="/assets/js/main.5057d4a7.js"></script>
</body>
</html>